<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Library</title>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        header {
            background-color: #5D4037;
            color: white;
            padding: 1rem;
            text-align: center;
            border-bottom: 4px solid #D7CCC8;
        }
        nav ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            background-color: #6D4C41;
        }
        nav ul li {
            margin: 0 1rem;
        }
        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 1rem;
            display: block;
        }
        nav ul li a:hover {
            background-color: #8D6E63;
        }
        main {
            padding: 1rem;
        }
        section {
            margin-bottom: 2rem;
        }
        .shelf {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            padding: 2rem;
            border: 4px solid #D7CCC8;
            border-radius: 10px;
            background-color: #E0C7A5;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .book {
            width: 120px;
            height: 200px;
            background-color: #A0522D;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .book:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .book img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 3px;
        }
        .horizontal-img {
            transform: rotate(90deg);
            transform-origin: left top;
            width: 100%;
            height: 100%;
        }
        .tooltip {
            visibility: hidden;
            width: 140px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -70px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }
        .book:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        .book-withdrawn {
            animation: pullOffShelf 0.5s forwards;
        }
        @keyframes pullOffShelf {
            0% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-50px) scale(1.05); }
            100% { transform: translateY(-100px) scale(1.1); }
        }
        footer {
            background-color: #5D4037;
            color: white;
            text-align: center;
            padding: 1rem;
            border-top: 4px solid #D7CCC8;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            padding: 1rem;
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 1rem;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 5px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover, .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        #searchBar {
            width: 100%;
            padding: 1rem;
            font-size: 1.2rem;
            border: 2px solid #D7CCC8;
            border-radius: 5px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #searchBar:focus {
            outline: none;
            border-color: #5D4037;
        }
    </style>
</head>
<body>
    <header>
        <h1>Welcome to the Interactive Library</h1>
        <nav>
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#categories">Categories</a></li>
                <li><a href="#recommended">Recommended</a></li>
                <li><a href="#search">Search</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="home">
            <h2>Discover Public Domain Works</h2>
            <p>Explore a collection of books, articles, and more, all in the public domain.</p>
        </section>

        <section id="categories">
            <h2>Categories</h2>
            <div class="shelf" id="categoryList">
                <!-- Categories will be dynamically inserted here -->
            </div>
        </section>

        <section id="recommended">
            <h2>Recommended Works</h2>
            <div class="shelf" id="recommendedList">
                <!-- Recommended works will be dynamically inserted here -->
            </div>
        </section>

        <section id="search">
            <h2>Search the Library</h2>
            <input type="text" id="searchBar" placeholder="Search by title, author, or genre">
            <div class="shelf" id="searchResults">
                <!-- Search results will be dynamically inserted here -->
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Interactive Library</p>
    </footer>

    <div id="bookModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalContent">
                <!-- Book details will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.5.3"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const categories = [
                'Fiction', 'Non-Fiction', 'Science', 'History', 'Philosophy', 'Art'
            ];

            const booksByCategory = {
                'Fiction': [
                    { title: 'Pride and Prejudice by Jane Austen', url: 'pdfs/Pride_and_Prejudice.pdf' },
                    { title: 'Moby Dick by Herman Melville', url: 'pdfs/Moby_Dick.pdf' },
                    { title: 'Frankenstein by Mary Shelley', url: 'pdfs/Frankenstein.pdf' },
                    { title: 'War and Peace by Leo Tolstoy', url: 'pdfs/War_and_Peace.pdf' },
                    { title: 'The Odyssey by Homer', url: 'pdfs/The_Odyssey.pdf' },
                    { title: 'Hamlet by William Shakespeare', url: 'pdfs/Hamlet.pdf' },
                    { title: 'The Iliad by Homer', url: 'pdfs/The_Iliad.pdf' },
                    { title: 'Crime and Punishment by Fyodor Dostoevsky', url: 'pdfs/Crime_and_Punishment.pdf' },
                    { title: 'Alice\'s Adventures in Wonderland by Lewis Carroll', url: 'pdfs/Alice_in_Wonderland.pdf' },
                    { title: 'The Picture of Dorian Gray by Oscar Wilde', url: 'pdfs/Dorian_Gray.pdf' },
                    // Additional books here...
                ],
                'Non-Fiction': [
                    { title: 'The Art of War by Sun Tzu', url: 'pdfs/Art_of_War.pdf' },
                    { title: 'The Prince by Niccolo Machiavelli', url: 'pdfs/The_Prince.pdf' },
                    { title: 'Walden by Henry David Thoreau', url: 'pdfs/Walden.pdf' },
                    { title: 'Meditations by Marcus Aurelius', url: 'pdfs/Meditations.pdf' },
                    { title: 'The Confessions by Saint Augustine', url: 'pdfs/Confessions.pdf' },
                    { title: 'The Wealth of Nations by Adam Smith', url: 'pdfs/Wealth_of_Nations.pdf' },
                    { title: 'The Interpretation of Dreams by Sigmund Freud', url: 'pdfs/Interpretation_of_Dreams.pdf' },
                    { title: 'On the Origin of Species by Charles Darwin', url: 'pdfs/Origin_of_Species.pdf' },
                    { title: 'Civil Disobedience by Henry David Thoreau', url: 'pdfs/Civil_Disobedience.pdf' },
                    { title: 'The Souls of Black Folk by W.E.B. Du Bois', url: 'pdfs/Souls_of_Black_Folk.pdf' },
                    // Additional books here...
                ],
                'Science': [
                    { title: 'The Principia by Isaac Newton', url: 'pdfs/Principia.pdf' },
                    { title: 'Relativity: The Special and General Theory by Albert Einstein', url: 'pdfs/Relativity.pdf' },
                    { title: 'On the Origin of Species by Charles Darwin', url: 'pdfs/Origin_of_Species.pdf' },
                    { title: 'The Republic by Plato', url: 'pdfs/The_Republic.pdf' },
                    { title: 'A Brief History of Time by Stephen Hawking', url: 'pdfs/Brief_History_of_Time.pdf' },
                    { title: 'The Structure of Scientific Revolutions by Thomas S. Kuhn', url: 'pdfs/Structure_of_Scientific_Revolutions.pdf' },
                    { title: 'The Double Helix by James D. Watson', url: 'pdfs/Double_Helix.pdf' },
                    { title: 'The Selfish Gene by Richard Dawkins', url: 'pdfs/Selfish_Gene.pdf' },
                    { title: 'The Demon-Haunted World by Carl Sagan', url: 'pdfs/Demon_Haunted_World.pdf' },
                    { title: 'Cosmos by Carl Sagan', url: 'pdfs/Cosmos.pdf' },
                    // Additional books here...
                ],
                'History': [
                    { title: 'The History of Herodotus by Herodotus', url: 'pdfs/History_of_Herodotus.pdf' },
                    { title: 'The History of the Peloponnesian War by Thucydides', url: 'pdfs/Peloponnesian_War.pdf' },
                    { title: 'The Decline and Fall of the Roman Empire by Edward Gibbon', url: 'pdfs/Decline_and_Fall.pdf' },
                    { title: 'A People’s History of the United States by Howard Zinn', url: 'pdfs/Peoples_History.pdf' },
                    { title: 'The Civil War by Shelby Foote', url: 'pdfs/Civil_War.pdf' },
                    { title: 'Guns, Germs, and Steel by Jared Diamond', url: 'pdfs/Guns_Germs_Steel.pdf' },
                    { title: 'The Diary of a Young Girl by Anne Frank', url: 'pdfs/Diary_of_Anne_Frank.pdf' },
                    { title: 'The Rise and Fall of the Third Reich by William L. Shirer', url: 'pdfs/Rise_and_Fall_Third_Reich.pdf' },
                    { title: 'Team of Rivals by Doris Kearns Goodwin', url: 'pdfs/Team_of_Rivals.pdf' },
                    { title: 'The Wright Brothers by David McCullough', url: 'pdfs/Wright_Brothers.pdf' },
                    // Additional books here...
                ],
                'Philosophy': [
                    { title: 'The Republic by Plato', url: 'pdfs/The_Republic.pdf' },
                    { title: 'Beyond Good and Evil by Friedrich Nietzsche', url: 'pdfs/Beyond_Good_and_Evil.pdf' },
                    { title: 'Meditations by Marcus Aurelius', url: 'pdfs/Meditations.pdf' },
                    { title: 'Critique of Pure Reason by Immanuel Kant', url: 'pdfs/Critique_of_Pure_Reason.pdf' },
                    { title: 'Thus Spoke Zarathustra by Friedrich Nietzsche', url: 'pdfs/Thus_Spoke_Zarathustra.pdf' },
                    { title: 'The Prince by Niccolo Machiavelli', url: 'pdfs/The_Prince.pdf' },
                    { title: 'The Social Contract by Jean-Jacques Rousseau', url: 'pdfs/Social_Contract.pdf' },
                    { title: 'Leviathan by Thomas Hobbes', url: 'pdfs/Leviathan.pdf' },
                    { title: 'The Ethics by Benedict de Spinoza', url: 'pdfs/The_Ethics.pdf' },
                    { title: 'The Communist Manifesto by Karl Marx and Friedrich Engels', url: 'pdfs/Communist_Manifesto.pdf' },
                    // Additional books here...
                ],
                'Art': [
                    { title: 'The Story of Art by E.H. Gombrich', url: 'pdfs/Story_of_Art.pdf' },
                    { title: 'Ways of Seeing by John Berger', url: 'pdfs/Ways_of_Seeing.pdf' },
                    { title: 'The Lives of the Artists by Giorgio Vasari', url: 'pdfs/Lives_of_the_Artists.pdf' },
                    { title: 'Leonardo da Vinci by Walter Isaacson', url: 'pdfs/Leonardo_da_Vinci.pdf' },
                    { title: 'The Letters of Vincent Van Gogh by Vincent Van Gogh', url: 'pdfs/Letters_of_Van_Gogh.pdf' },
                    { title: 'Art: A History of Painting, Sculpture, and Architecture by Frederick Hartt', url: 'pdfs/Art_History.pdf' },
                    { title: 'The Power of Art by Simon Schama', url: 'pdfs/Power_of_Art.pdf' },
                    { title: 'The Shock of the New by Robert Hughes', url: 'pdfs/Shock_of_the_New.pdf' },
                    { title: 'The Story of Modern Art by Norbert Lynton', url: 'pdfs/Story_of_Modern_Art.pdf' },
                    { title: 'The Art Spirit by Robert Henri', url: 'pdfs/Art_Spirit.pdf' },
                    // Additional books here...
                ]
            };

            const categoryList = document.getElementById('categoryList');
            const recommendedList = document.getElementById('recommendedList');
            const searchResults = document.getElementById('searchResults');
            let userInteractions = [];

            const fetchBookCover = async (title) => {
                const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title.split(' by ')[0])}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.thumbnail && data.thumbnail.source) {
                        const img = new Image();
                        img.src = data.thumbnail.source;
                        await img.decode();
                        return data.thumbnail.source;
                    }
                }
                return 'https://via.placeholder.com/120x180'; // Placeholder image if cover is not available
            };

            const fetchBookSummary = async (title) => {
                const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title.split(' by ')[0])}`);
                if (response.ok) {
                    const data = await response.json();
                    // Check if the summary is about the book
                    if (data.extract && (data.extract.includes("novel") || data.extract.includes("book"))) {
                        return data.extract;
                    } else {
                        return 'Summary not available.';
                    }
                } else {
                    return 'Summary not available.';
                }
            };

            const displayBooks = async (works, container) => {
                container.innerHTML = '';
                for (const work of works) {
                    const coverUrl = await fetchBookCover(work.title);
                    const bookItem = document.createElement('div');
                    bookItem.className = 'book';
                    bookItem.innerHTML = `
                        <img src="${coverUrl}" alt="${work.title}" class="book-cover">
                        <div class="tooltip">${work.title}</div>
                    `;
                    bookItem.querySelector('img').onload = function () {
                        if (this.naturalWidth > this.naturalHeight) {
                            this.classList.add('horizontal-img');
                        }
                    };
                    bookItem.addEventListener('click', async () => {
                        const summary = await fetchBookSummary(work.title);
                        showModal(work.title, coverUrl, summary, work.url);
                        bookItem.classList.add('book-withdrawn');
                        setTimeout(() => {
                            bookItem.classList.remove('book-withdrawn');
                        }, 500);
                        logUserInteraction(work.title);
                        updateRecommendations();
                    });
                    container.appendChild(bookItem);
                }
            };

            const showModal = (title, coverUrl, summary, url) => {
                const modal = document.getElementById('bookModal');
                const modalContent = document.getElementById('modalContent');
                modalContent.innerHTML = `
                    <h2>${title}</h2>
                    <img src="${coverUrl}" alt="${title}" class="book-cover">
                    <p>${summary}</p>
                    <a href="${url}" download>Download PDF</a>
                `;
                modal.style.display = 'block';
            };

            document.querySelector('.close').addEventListener('click', () => {
                document.getElementById('bookModal').style.display = 'none';
            });

            window.onclick = function(event) {
                const modal = document.getElementById('bookModal');
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            };

            const logUserInteraction = (title) => {
                userInteractions.push(title);
                if (userInteractions.length > 5) {
                    userInteractions.shift(); // Keep the last 5 interactions
                }
            };

            const updateRecommendations = () => {
                const recommendedBooks = new Set();
                userInteractions.forEach(interaction => {
                    for (const category in booksByCategory) {
                        booksByCategory[category].forEach(book => {
                            if (book.title.includes(interaction.split(' by ')[0])) {
                                recommendedBooks.add(book);
                            }
                        });
                    }
                });
                // Ensure there are 30 books in the recommendations
                const allBooks = Object.values(booksByCategory).flat();
                while (recommendedBooks.size < 30) {
                    recommendedBooks.add(allBooks[Math.floor(Math.random() * allBooks.length)]);
                }
                displayBooks(Array.from(recommendedBooks), recommendedList);
            };

            categories.forEach(category => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'book';
                categoryItem.textContent = category;
                categoryList.appendChild(categoryItem);

                categoryItem.addEventListener('click', () => {
                    displayBooks(booksByCategory[category], searchResults);
                });
            });

            displayBooks(booksByCategory['Fiction'], recommendedList);

            const options = {
                keys: ['title'],
                threshold: 0.3 // Adjust the threshold for fuzzy search accuracy
            };
            const fuse = new Fuse(Object.values(booksByCategory).flat(), options);

            document.getElementById('searchBar').addEventListener('input', async function() {
                const query = this.value;
                const results = fuse.search(query).map(result => result.item);
                await displayBooks(results, searchResults);
            });
        });
    </script>
</body>
</html>
